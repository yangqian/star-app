{{define "content"}}
<h1>Family Star Board</h1>

<div class="filter-selector">
    <button class="filter-btn active" onclick="filterCards('all')">All</button>
    <button class="filter-btn" onclick="filterCards('kids')">Kids</button>
    <button class="filter-btn" onclick="filterCards('parents')">Parents</button>
    <span class="filter-separator"></span>
    {{range .StarCounts}}
    <button class="filter-btn" onclick="filterCards('{{.Username}}')">{{.Username}}</button>
    {{end}}
</div>

<div class="star-counts">
    {{range .StarCounts}}
    <div class="member-card" data-username="{{.Username}}" data-role="{{if .IsAdmin}}parent{{else}}kid{{end}}" data-self="{{if eq .Username $.User.Username}}true{{else}}false{{end}}" onclick="selectUser('{{.Username}}')" title="Click to select">
        <h2>{{.Username}}</h2>
        <div class="star-number">{{.CurrentStars}}</div>
        <div class="star-label">current stars</div>
        <div class="star-total">{{.StarCount}} total earned</div>
    </div>
    {{end}}
</div>

{{if .User.IsAdmin}}
<div class="action-bar" id="actionBar" style="display:none;">
    <span>Selected: <strong id="selectedName"></strong></span>
    <button onclick="togglePanel('reasonPanel')">Award Star</button>
    <button onclick="togglePanel('redeemPanel')">Redeem</button>
</div>

<div class="reason-panel" id="reasonPanel" style="display:none;">
    <h3>Choose a reason</h3>
    <div class="reason-list">
        {{range .Reasons}}
        <div class="reason-item" onclick="submitStar('{{.Text}}')">{{.Text}} <span class="reason-count">({{.Count}})</span></div>
        {{end}}
    </div>
    <div class="reason-custom">
        <input type="text" id="customReason" placeholder="Custom reason...">
        <button onclick="submitStar(document.getElementById('customReason').value)">Add</button>
    </div>
</div>

<div class="reason-panel" id="redeemPanel" style="display:none;">
    <h3>Choose a reward</h3>
    <div class="reason-list">
        {{range .Rewards}}
        <div class="reason-item" onclick="submitRedeem({{.ID}}, '{{.Name}}', {{.Cost}})">{{.Icon}} {{.Name}} <span class="reason-count">({{.Cost}} ⭐)</span></div>
        {{end}}
    </div>
</div>
{{end}}

<h2>Recent Redemptions</h2>
<table>
    <thead>
        <tr><th>Who</th><th>Reward</th><th>Cost</th><th>When</th></tr>
    </thead>
    <tbody>
        {{range .Redemptions}}
        <tr data-username="{{.Username}}">
            <td>{{.Username}}</td>
            <td>{{.RewardName}}</td>
            <td>{{.Cost}} ⭐</td>
            <td>{{.CreatedAt.Format "Jan 2 15:04"}}</td>
        </tr>
        {{else}}
        <tr><td colspan="4">No redemptions yet!</td></tr>
        {{end}}
    </tbody>
</table>

<h2>Recent Stars</h2>
<table>
    <thead>
        <tr><th>Who</th><th>Reason</th><th>Awarded By</th><th>When</th><th></th></tr>
    </thead>
    <tbody>
        {{range .Stars}}
        <tr data-star-id="{{.ID}}" data-username="{{.Username}}">
            <td>{{.Username}}</td>
            <td>{{.Display}}</td>
            <td>{{.AwardedByName}}</td>
            <td>{{.CreatedAt.Format "Jan 2 15:04"}}</td>
            {{if $.User.IsAdmin}}<td><button class="btn-undo" onclick="undoStar({{.ID}})" title="Remove this star">✕</button></td>{{else}}<td></td>{{end}}
        </tr>
        {{else}}
        <tr><td colspan="5">No stars yet!</td></tr>
        {{end}}
    </tbody>
</table>
{{end}}
{{template "layout" .}}
