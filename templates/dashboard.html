{{define "content"}}
<div class="dashboard-header">
    <h1 data-i18n="star_board">Family Star Board</h1>
    {{if .User.IsAdmin}}
    <button class="announce-toggle {{if eq .HAEnabled "1"}}on{{end}}" id="announceToggle" onclick="toggleAnnounce()" title="Toggle announcements">
        üîä <span data-i18n="{{if eq .HAEnabled "1"}}announce_on{{else}}announce_off{{end}}">{{if eq .HAEnabled "1"}}On{{else}}Off{{end}}</span>
    </button>
    {{end}}
</div>

<div class="selection-bar">
<div class="mode-selector">
    <button class="mode-btn active" data-mode="individual" onclick="setSelectionMode('individual')" data-i18n="mode_individual">Single</button>
    <button class="mode-btn" data-mode="multiple" onclick="setSelectionMode('multiple')" data-i18n="mode_multiple">Multi</button>
</div>
<div class="filter-selector">
    <button class="filter-btn active" onclick="filterCards('all')" data-i18n="all">All</button>
    <button class="filter-btn" onclick="filterCards('kids')" data-i18n="kids">Kids</button>
    <button class="filter-btn" onclick="filterCards('parents')" data-i18n="parents">Parents</button>
    <span class="filter-separator"></span>
    {{range .StarCounts}}
    <button class="filter-btn" onclick="filterCards('{{.Username}}')">{{.Username}}</button>
    {{end}}
</div>
</div>

<div class="star-counts">
    {{range .StarCounts}}
    <div class="member-card" data-username="{{.Username}}" data-role="{{if .IsAdmin}}parent{{else}}kid{{end}}" data-self="{{if eq .Username $.User.Username}}true{{else}}false{{end}}" onclick="selectUser('{{.Username}}')" title="Click to select">
        <h2>{{.Username}}</h2>
        <div class="star-number">{{.CurrentStars}}</div>
        <div class="star-label" data-i18n="current_stars">current stars</div>
        <div class="star-total">{{.StarCount}} <span data-i18n="total_earned">total earned</span></div>
    </div>
    {{end}}
</div>

{{if .User.IsAdmin}}
<div class="action-bar" id="actionBar" style="display:none;">
    <span><span data-i18n="selected">Selected:</span> <strong id="selectedName"></strong></span>
    <button onclick="togglePanel('reasonPanel')" data-i18n="award_star">Award Star</button>
    <button onclick="togglePanel('redeemPanel')" data-i18n="redeem">Redeem</button>
</div>

<div class="reason-panel" id="reasonPanel" style="display:none;">
    <h3 data-i18n="choose_reason">Choose a reason</h3>
    <div class="reason-list">
        {{range .Reasons}}
        <div class="reason-item reason-trans" data-reason-id="{{.ID}}" data-en="{{index .Translations "en"}}" data-zh-cn="{{index .Translations "zh-CN"}}" data-zh-tw="{{index .Translations "zh-TW"}}" onclick="submitStarByReason({{.ID}})">
            <span class="reason-text">{{index .Translations "en"}}</span> <span class="reason-count">({{.Stars}} ‚≠ê √ó {{.Count}})</span>
        </div>
        {{end}}
    </div>
    <div class="reason-custom">
        <input type="text" id="customReason" data-i18n-placeholder="custom_reason" placeholder="Custom reason..." style="flex:1">
        <input type="number" id="customStars" min="1" value="1" style="width:4rem" title="Number of stars">
        <button onclick="submitStar(document.getElementById('customReason').value, null, document.getElementById('customStars').value)" data-i18n="add">Add</button>
    </div>
</div>

<div class="reason-panel" id="redeemPanel" style="display:none;">
    <h3 data-i18n="choose_reward">Choose a reward</h3>
    <div class="reason-list">
        {{range .Rewards}}
        <div class="reason-item reward-trans" data-reward-id="{{.ID}}" data-en="{{index .Translations "en"}}" data-zh-cn="{{index .Translations "zh-CN"}}" data-zh-tw="{{index .Translations "zh-TW"}}" onclick="submitRedeem({{.ID}}, '{{index .Translations "en"}}', {{.Cost}})">{{.Icon}} <span class="reward-text">{{index .Translations "en"}}</span> <span class="reason-count">({{.Cost}} ‚≠ê)</span></div>
        {{end}}
    </div>
</div>
{{end}}

<h2 data-i18n="recent_redemptions">Recent Redemptions</h2>
<table>
    <thead>
        <tr><th data-i18n="who">Who</th><th data-i18n="reward">Reward</th><th data-i18n="cost">Cost</th><th data-i18n="when">When</th></tr>
    </thead>
    <tbody>
        {{range .Redemptions}}
        <tr data-username="{{.Username}}">
            <td>{{.Username}}</td>
            <td class="reward-name" data-en="{{.RewardNameEN}}" data-zh-cn="{{.RewardNameCN}}" data-zh-tw="{{.RewardNameTW}}">{{.RewardName}}</td>
            <td>{{.Cost}} ‚≠ê</td>
            <td>{{.CreatedAt.Format "Jan 2 15:04"}}</td>
        </tr>
        {{else}}
        <tr><td colspan="4" data-i18n="no_redemptions">No redemptions yet!</td></tr>
        {{end}}
    </tbody>
</table>

<h2 data-i18n="recent_stars">Recent Stars</h2>
<table>
    <thead>
        <tr><th data-i18n="who">Who</th><th data-i18n="reason">Reason</th><th data-i18n="awarded_by">Awarded By</th><th data-i18n="when">When</th><th></th></tr>
    </thead>
    <tbody>
        {{range .Stars}}
        <tr data-star-id="{{.ID}}" data-username="{{.Username}}">
            <td>{{.Username}}</td>
            <td class="star-reason" data-en="{{.ReasonEN}}" data-zh-cn="{{.ReasonCN}}" data-zh-tw="{{.ReasonTW}}">{{.Display}}</td>
            <td>{{.AwardedByName}}</td>
            <td>{{.CreatedAt.Format "Jan 2 15:04"}}</td>
            {{if $.User.IsAdmin}}<td><button class="btn-undo" onclick="undoStar({{.ID}})" title="Remove this star">‚úï</button></td>{{else}}<td></td>{{end}}
        </tr>
        {{else}}
        <tr><td colspan="5" data-i18n="no_stars">No stars yet!</td></tr>
        {{end}}
    </tbody>
</table>
{{end}}
{{template "layout" .}}
