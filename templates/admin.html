{{define "content"}}
<h1 data-i18n="admin_panel">Admin Panel</h1>

<section>
    <h2 data-i18n="award_a_star">Award a Star</h2>
    <table>
        <thead><tr><th data-i18n="who">Who</th><th data-i18n="reason">Reason</th><th data-i18n="stars">Stars</th><th data-i18n="count">Count</th><th data-i18n="actions">Actions</th></tr></thead>
        <tbody>
            {{range .Reasons}}
            <tr>
                <form method="POST" action="/admin/star" style="background:none;padding:0;margin:0;box-shadow:none;">
                    <td>
                        <select name="username" required style="width:100%">
                            <option value="" data-i18n="select">Select...</option>
                            {{range $.Users}}
                            <option value="{{.Username}}">{{.Username}}</option>
                            {{end}}
                        </select>
                    </td>
                    <td><input type="text" name="reason" value="{{index .Translations "en"}}" required style="width:100%"></td>
                    <td style="text-align:center">{{.Stars}}</td>
                    <td style="text-align:center">{{.Count}}</td>
                    <td><button type="submit" data-i18n="award">Award</button></td>
                </form>
            </tr>
            {{else}}
            <tr><td colspan="5" data-i18n="no_reasons">No reasons used yet</td></tr>
            {{end}}
            <tr>
                <form method="POST" action="/admin/star" style="background:none;padding:0;margin:0;box-shadow:none;">
                    <td>
                        <select name="username" required style="width:100%">
                            <option value="" data-i18n="select">Select...</option>
                            {{range $.Users}}
                            <option value="{{.Username}}">{{.Username}}</option>
                            {{end}}
                        </select>
                    </td>
                    <td><input type="text" name="reason" data-i18n-placeholder="what_did_they_do" placeholder="What did they do?" required style="width:100%"></td>
                    <td><input type="number" name="stars" min="1" value="1" style="width:4rem;text-align:center"></td>
                    <td></td>
                    <td><button type="submit" data-i18n="award">Award</button></td>
                </form>
            </tr>
        </tbody>
    </table>
</section>

<section>
    <h2 data-i18n="rewards">Rewards</h2>
    <h3>Reward Translations <span style="font-size:0.8rem;font-weight:normal;">(Click to edit)</span></h3>
    <table>
        <thead>
            <tr>
                <th data-i18n="icon">Icon</th>
                <th>English</th>
                <th>ÁÆÄ‰Ωì‰∏≠Êñá</th>
                <th>ÁπÅÈ´î‰∏≠Êñá</th>
                <th data-i18n="stars">Stars</th>
                <th data-i18n="actions">Actions</th>
            </tr>
        </thead>
        <tbody>
            {{range .Rewards}}
            <tr>
                <td style="text-align:center;font-size:1.5rem">{{.Icon}}</td>
                <td class="editable-trans" onclick="editRewardTrans({{.ID}}, 'en', this)">{{index .Translations "en"}}</td>
                <td class="editable-trans" onclick="editRewardTrans({{.ID}}, 'zh-CN', this)">{{index .Translations "zh-CN"}}</td>
                <td class="editable-trans" onclick="editRewardTrans({{.ID}}, 'zh-TW', this)">{{index .Translations "zh-TW"}}</td>
                <td style="text-align:center">{{.Cost}}</td>
                <td>
                    <button class="btn-danger" onclick="deleteReward({{.ID}})" data-i18n="delete">Delete</button>
                </td>
            </tr>
            {{else}}
            <tr><td colspan="6" data-i18n="no_rewards">No rewards configured</td></tr>
            {{end}}
        </tbody>
    </table>
    <h3 data-i18n="add_reward">Add Reward</h3>
    <form method="POST" action="/admin/reward">
        <div style="display:flex;gap:0.5rem;align-items:end;">
            <div><label data-i18n="icon">Icon</label><input type="text" name="icon" placeholder="üéÅ" style="width:3rem;text-align:center"></div>
            <div style="flex:1"><label data-i18n="name">Name</label><input type="text" name="name" data-i18n-placeholder="reward_name" placeholder="Reward name" required></div>
            <div><label data-i18n="stars">Stars</label><input type="number" name="cost" placeholder="5" min="1" required style="width:5rem"></div>
            <button type="submit" style="margin-bottom:0.5rem" data-i18n="add">Add</button>
        </div>
    </form>
</section>

<section>
    <h2 data-i18n="api_keys">API Keys</h2>
    {{if .NewKey}}
    <div class="alert">
        New API key (copy now, shown only once):<br>
        <code id="new-key">{{.NewKey}}</code>
    </div>
    {{end}}

    <form method="POST" action="/admin/apikey">
        <input type="text" name="label" data-i18n-placeholder="label_placeholder" placeholder="Label (e.g. Home Assistant)" required>
        <button type="submit" data-i18n="generate_key">Generate Key</button>
    </form>

    <table>
        <thead><tr><th data-i18n="label">Label</th><th data-i18n="created">Created</th><th data-i18n="action">Action</th></tr></thead>
        <tbody>
            {{range .APIKeys}}
            <tr>
                <td>{{.Label}}</td>
                <td>{{.CreatedAt.Format "Jan 2, 2006"}}</td>
                <td>
                    <button class="btn-danger" onclick="deleteKey({{.ID}})" data-i18n="revoke">Revoke</button>
                </td>
            </tr>
            {{else}}
            <tr><td colspan="3" data-i18n="no_api_keys">No API keys</td></tr>
            {{end}}
        </tbody>
    </table>
</section>

<section>
    <h2 data-i18n="ha_announce">Home Assistant Announce</h2>
    <form method="POST" action="/admin/settings">
        <label class="toggle-label">
            <input type="checkbox" name="ha_enabled" value="1" {{if eq .HAEnabled "1"}}checked{{end}}>
            <span data-i18n="ha_enabled_label">Enable announcements</span>
        </label>
        <label data-i18n="ha_url_label">Home Assistant URL</label>
        <input type="text" name="ha_url" value="{{.HAUrl}}" placeholder="https://home.xxx.xxx">
        <label data-i18n="ha_token_label">Long-Lived Access Token</label>
        <input type="password" name="ha_token" value="{{.HAToken}}" placeholder="eyJ...">
        <label data-i18n="ha_media_player_label">Media Player Entity</label>
        <input type="text" name="ha_media_player" value="{{.HAMediaPlayer}}" placeholder="media_player.home_2">
        <button type="submit" data-i18n="save">Save</button>
    </form>
</section>

<section>
    <h2>Reason Translations <span style="font-size:0.8rem;font-weight:normal;">(Click to edit)</span></h2>
    <table>
        <thead>
            <tr>
                <th>Key</th>
                <th>English</th>
                <th>ÁÆÄ‰Ωì‰∏≠Êñá</th>
                <th>ÁπÅÈ´î‰∏≠Êñá</th>
                <th data-i18n="stars">Stars</th>
                <th data-i18n="count">Count</th>
                <th data-i18n="actions">Actions</th>
            </tr>
        </thead>
        <tbody>
            {{range .Reasons}}
            <tr>
                <td>{{.Key}}</td>
                <td class="editable-trans" onclick="editReasonTrans({{.ID}}, 'en', this)">{{index .Translations "en"}}</td>
                <td class="editable-trans" onclick="editReasonTrans({{.ID}}, 'zh-CN', this)">{{index .Translations "zh-CN"}}</td>
                <td class="editable-trans" onclick="editReasonTrans({{.ID}}, 'zh-TW', this)">{{index .Translations "zh-TW"}}</td>
                <td class="editable-stars" onclick="editReasonStars({{.ID}}, this)" style="text-align:center;cursor:pointer;padding:0.5rem" title="Click to edit">{{.Stars}}</td>
                <td style="text-align:center">{{.Count}}</td>
                <td>
                    <button class="btn-danger" onclick="deleteReasonEntry({{.ID}})" data-i18n="delete">Delete</button>
                </td>
            </tr>
            {{else}}
            <tr><td colspan="7" data-i18n="no_reasons">No reasons used yet</td></tr>
            {{end}}
        </tbody>
    </table>
</section>
{{end}}
{{template "layout" .}}
