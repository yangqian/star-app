{{define "content"}}
<h1>Admin Panel</h1>

<section>
    <h2>Award a Star</h2>
    <form method="POST" action="/admin/star">
        <label>Family Member</label>
        <select name="username" required>
            <option value="">Select...</option>
            {{range .Users}}
            <option value="{{.Username}}">{{.Username}}</option>
            {{end}}
        </select>

        <label>Reason</label>
        <input type="text" name="reason" id="reason-input" list="reason-list" placeholder="What did they do?" required>
        <datalist id="reason-list">
            {{range .Reasons}}
            <option value="{{.Text}}">
            {{end}}
        </datalist>

        <button type="submit">Award Star</button>
    </form>
</section>

<section>
    <h2>Rewards</h2>
    <table>
        <thead><tr><th>Icon</th><th>Name</th><th>Stars</th><th>Actions</th></tr></thead>
        <tbody>
            {{range .Rewards}}
            <tr>
                <form method="POST" action="/admin/reward/{{.ID}}" style="background:none;padding:0;margin:0;box-shadow:none;">
                    <td><input type="text" name="icon" value="{{.Icon}}" style="width:3rem;text-align:center"></td>
                    <td><input type="text" name="name" value="{{.Name}}" required></td>
                    <td><input type="number" name="cost" value="{{.Cost}}" min="1" required style="width:5rem"></td>
                    <td>
                        <button type="submit">Save</button>
                        <button type="button" class="btn-danger" onclick="deleteReward({{.ID}})">Delete</button>
                    </td>
                </form>
            </tr>
            {{else}}
            <tr><td colspan="4">No rewards configured</td></tr>
            {{end}}
        </tbody>
    </table>
    <h3>Add Reward</h3>
    <form method="POST" action="/admin/reward">
        <div style="display:flex;gap:0.5rem;align-items:end;">
            <div><label>Icon</label><input type="text" name="icon" placeholder="ðŸŽ" style="width:3rem;text-align:center"></div>
            <div style="flex:1"><label>Name</label><input type="text" name="name" placeholder="Reward name" required></div>
            <div><label>Stars</label><input type="number" name="cost" placeholder="5" min="1" required style="width:5rem"></div>
            <button type="submit" style="margin-bottom:0.5rem">Add</button>
        </div>
    </form>
</section>

<section>
    <h2>API Keys</h2>
    {{if .NewKey}}
    <div class="alert">
        New API key (copy now, shown only once):<br>
        <code id="new-key">{{.NewKey}}</code>
    </div>
    {{end}}

    <form method="POST" action="/admin/apikey">
        <input type="text" name="label" placeholder="Label (e.g. Home Assistant)" required>
        <button type="submit">Generate Key</button>
    </form>

    <table>
        <thead><tr><th>Label</th><th>Created</th><th>Action</th></tr></thead>
        <tbody>
            {{range .APIKeys}}
            <tr>
                <td>{{.Label}}</td>
                <td>{{.CreatedAt.Format "Jan 2, 2006"}}</td>
                <td>
                    <button class="btn-danger" onclick="deleteKey({{.ID}})">Revoke</button>
                </td>
            </tr>
            {{else}}
            <tr><td colspan="3">No API keys</td></tr>
            {{end}}
        </tbody>
    </table>
</section>
{{end}}
{{template "layout" .}}
